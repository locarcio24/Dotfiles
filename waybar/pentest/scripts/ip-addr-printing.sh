#!/usr/bin/env bash

interface=$(ip address | grep "state UP" | awk '{print $2}' | tr -d ":")
ip_addr=$(ip address | grep -A 2 "state UP" | tail -n 1 | awk '{print $2}' | cut -d '/' -f 1)
tooltip=$(iwconfig 2>/dev/null | grep "ESSID" | awk 'NF{print $NF}' | tail -n 1 | tr -d "\n" | cut -d ':' -f 2)

if [[ -z $ip_addr ]]; then
  ip_addr="Disconnected"
  interface="disconnected"
  tooltip="\"Disconnected\""
  ip link | sed -n '/^[0-9]:*/p' | awk '{print $2}' | tr -d ":" > interfaces
  while read -r line;do
    if [[ $line == "wlan0mon" ]];then
      ip_addr="Monitor mode"
      tooltip="\"Monitor mode\""
      break
    fi;
  done <interfaces
  rm interfaces
fi

#tooltip=$(iwconfig 2>/dev/null | grep "ESSID" | awk 'NF{print $NF}' | cut -d ':' -f 2 )

echo -e "{ \"text\": \" $ip_addr \", \"alt\": \"$interface\", \"tooltip\": $tooltip }"
